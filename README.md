# Coding Friend

<p align="center">
  <img src="assets/logo.svg" alt="Coding Friend Logo" width="100" />
</p>

Lean toolkit for disciplined engineering workflows with Claude Code.

> [!WARNING]  
> This repository is in heavy development, use at your own risk.

## ‚ú® What It Does

- Enforces test-driven development (TDD)
- Provides systematic debugging methodology
- Quick bug fix workflow (`/cf-fix`)
- Structured optimization with before/after measurement (`/cf-optimize`)
- Quick Q&A about codebase with memory (`/cf-ask`)
- Ensures verification before claiming done
- Smart conventional commits and code review
- Captures project knowledge across sessions (via `/cf-remember`).
- Helps humans learn from vibe coding sessions (generated by `/cf-learn`). Host learning docs as a local website at `localhost:3333` (via `cf host`) or setup MCP server (via `cf mcp`) so that you can use it in other LLM clients.
- In-depth research with web search and parallel subagents (via `/cf-research`).
- **Prompt injection defense** ‚Äî layered content isolation protects against malicious instructions embedded in web content. All external data (WebFetch, WebSearch, MCP tools) is treated as untrusted. See [Security](#-security) section.
- Customize the Claude Code statusline
  ```bash
  cf v0.0.1 ‚îÇ ProjectName ‚îÇ Opus 4.6 ‚îÇ ‚éá branchName ‚îÇ 15% ‚Üí 13:00
  ```

## üöÄ Usage & How It Works

Simply describe what you need in natural language. Read more in [workflows.md](docs/workflows.md).


| Command                 | Description                                                                                                                                                                      | Example                               |
| ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------- |
| `/cf-plan [task]`       | Brainstorm and write implementation plan                                                                                                                                         | `/cf-plan Build a REST API with auth` |
| `/cf-fix [bug]`         | Quick bug fix workflow                                                                                                                                                           | `/cf-fix Login fails with 401`        |
| `/cf-ask [question]`    | Quick Q&A about codebase ‚Üí `docs/memory/`                                                                                                                                        | `/cf-ask How does auth work?`         |
| `/cf-optimize [target]` | Structured optimization with before/after measurement                                                                                                                            | `/cf-optimize getUserById query`      |
| `/cf-review [target]`   | Code review in forked subagent                                                                                                                                                   | `/cf-review src/auth/`                |
| `/cf-commit [hint]`     | Analyze diff and create conventional commit                                                                                                                                      | `/cf-commit refactor auth`            |
| `/cf-ship [hint]`       | Verify, commit, push, and create PR                                                                                                                                              | `/cf-ship Add notifications`          |
| `/cf-remember [topic]`  | Helps AI quickly capture things they've already researched and begin work ‚Üí `docs/memory/`                                                                                       | `/cf-remember auth flow`              |
| `/cf-learn [topic]`     | Helps humans truly learn from vibe coding with auto-generated docs, a beautiful website, and an MCP server that can be integrated with LLM services like ChatGPT ‚Üí `docs/learn/` | `/cf-learn`                           |
| `/cf-research [topic]`  | In-depth research with web search ‚Üí `docs/research/`                                                                                                                             | `/cf-research key ideas of repo X`    |


Auto-invoked skills (no slash needed): `cf-tdd` when writing code, `cf-sys-debug` when debugging, `cf-code-review` when reviewing, `cf-verification` before claiming done.

There is always a security layer to protect you from prompt injection attacks.

## üì¶ Installation

- **Prerequisites**: Some skills use the [GitHub CLI (`gh`)](https://cli.github.com/) for creating PRs. Install with `brew install gh && gh auth login`. Without it, skills fall back to manual alternatives.
- Install the Coding Friend CLI:
  ```bash
  npm i -g coding-friend-cli

  # or update
  npm update -g coding-friend-cli
  ```
  üßë‚Äçüíª Read more in [for-dev.md](docs/for-dev.md) for local development.
- Run `claude` and install the plugin from the marketplace:
  ```
  /plugin marketplace add dinhanhthi/coding-friend
  /plugin install coding-friend@coding-friend-marketplace
  ```
  - ‚òùÔ∏è We install this kit as a global plugin (install once, use in every project). In case we don't want to use it in any project, we can opt-out it.
  - **Cursor** is automatically detected if it's already installed in Claude Code. If you don't use Claude Code, please wait for Cursor support to be released.
  - üßë‚Äçüíª Read more in [for-dev.md](docs/for-dev.md) for local development.
- **In each project**, run `cf init` to set up the workspace folders (`docs/plans`, `docs/memory`, `docs/research`, `docs/learn`) and optionally add them to `.gitignore`.
- **Enable auto-update**: run `/plugin` > Go to installed plugins > select `coding-friend-marketplace` > Enable auto-update
- **Restart Claude Code** to load the plugin.

### üê≥ CLI Commands

```bash
cf init              # Initialize workspace (interactive)
                     # üí° You can run this anywhere, anytime.
cf host [path]       # Build and serve learning docs at localhost:3333
                     # [path] is optional, default is `docs/learn`
cf mcp [path]        # Setup MCP server for LLM integration
                     # [path] is optional, default is `docs/learn`
                     # This prints a JSON config snippet to add to your client's MCP
cf statusline        # Setup coding-friend statusline
cf update            # Update plugin + CLI + statusline
cf update --cli      # Update only the CLI (npm package)
cf update --plugin   # Update only the Claude Code plugin
cf update --statusline  # Update only the statusline
cf dev on [path]     # Switch to local plugin source for development
cf dev off           # Switch back to remote marketplace
cf dev status        # Show current dev mode (local or remote)
cf dev sync          # Sync local changes to cache (no version bump needed)
cf dev restart       # Reinstall local dev plugin (off + on)
cf help              # Show all commands
```

Tab completion is automatically added to `~/.zshrc` (or `~/.bashrc`) on first install and kept up-to-date automatically on every `cf update`.

### üõ†Ô∏è Other stuffs

- For local development, refer to [for-dev.md](docs/for-dev.md).
- Manage plugin:
  ```bash
  # Update marketplace
  /plugin marketplace update
  # Update plugin
  /plugin update coding-friend@coding-friend-marketplace
  # Uninstall plugin
  /plugin uninstall coding-friend@coding-friend-marketplace
  # Remove marketplace
  /plugin marketplace remove coding-friend-marketplace   # Remove marketplace
  ```
- **Disable plugin for a specific project** ‚Äî add to `.claude/settings.json` or `.claude/settings.local.json`:
  ```json
  {
    "enabledPlugins": {
      "coding-friend@coding-friend-marketplace": false
    }
  }
  ```

## üß∞ Configuration

### .coding-friend/config.json (optional)

Create `.coding-friend/config.json` in your project to customize settings:

```json
{
  "docsDir": "docs",
  "hooks": {
    "privacyBlock": true,
    "scoutBlock": true,
    "devRulesReminder": true,
    "contextTracker": true
  },
  "commit": {
    "verify": true,
    "conventionalCommits": true
  },
  "learn": {
    "outputDir": "docs/learn",
    "categories": [
      { "name": "Web_Dev", "description": "Web development" },
      { "name": "Tools", "description": "Developer tools and workflows" }
    ],
    "autoCommit": false,
    "readmeIndex": false
  }
}
```

All fields are optional. Defaults are used when omitted. No file = all defaults.


| Setting                      | Default              | Description                                                                                         |
| ---------------------------- | -------------------- | --------------------------------------------------------------------------------------------------- |
| `docsDir`                    | `"docs"`             | Root folder for plans, memory, learn, and research docs                                             |
| `hooks.privacyBlock`         | `true`               | Block access to .env and credentials                                                                |
| `hooks.scoutBlock`           | `true`               | Block access to .coding-friend/ignore patterns                                                      |
| `hooks.devRulesReminder`     | `true`               | Inject rules on every prompt                                                                        |
| `hooks.contextTracker`       | `true`               | Track files read per session                                                                        |
| `commit.verify`              | `true`               | Run tests before committing                                                                         |
| `commit.conventionalCommits` | `true`               | Enforce conventional commit format                                                                  |
| `learn.outputDir`            | `"{docsDir}/learn"`  | Where to store learning docs (supports `~/`, absolute, or relative paths)                           |
| `learn.categories`           | 5 default categories | Custom categories as `[{ "name": "...", "description": "..." }]`                                    |
| `learn.autoCommit`           | `false`              | Auto git-commit after writing learning docs                                                         |
| `learn.readmeIndex`          | `false`              | Index mode: `false` (none), `true` (single README), `"per-category"` (separate README per category) |


### .coding-friend/ignore

Add patterns to `.coding-friend/ignore` in your project to block agent access:

```
node_modules
dist
build
.next
__pycache__
```

### Privacy

The `privacy-block` hook automatically blocks access to:

- `.env` files (except `.env.example`)
- Credential files (`.pem`, `.key`, `id_rsa`)
- SSH directories (`.ssh/`)

Set `"privacyBlock": false` in `.coding-friend/config.json` to disable.

## üîí Security

All external data (web fetches, search results, MCP tools) is treated as untrusted. Layered defenses are applied at session start, per-prompt, per-skill, and per-agent level.

**Core behaviors:** never follow instructions from fetched content, never exfiltrate secrets, separate data from directives, flag suspicious content to the user.

**File-level protection:** `privacy-block.sh` blocks `.env`, credentials, SSH keys. `scout-block.sh` blocks patterns in `.coding-friend/ignore`.

## Internals

Hooks, agents, project structure

### Hooks


| Hook                    | Event                   | Purpose                                            |
| ----------------------- | ----------------------- | -------------------------------------------------- |
| `session-init.sh`       | SessionStart            | Bootstrap context                                  |
| `dev-rules-reminder.sh` | UserPromptSubmit        | Inject core rules                                  |
| `privacy-block.sh`      | PreToolUse              | Block .env, credentials                            |
| `scout-block.sh`        | PreToolUse              | Block .coding-friend/ignore patterns               |
| `statusline.sh`         | ‚Äî (via `cf statusline`) | Optional statusline (folder, model, branch, usage) |
| `compact-marker.sh`     | PreCompact              | Preserve context                                   |
| `context-tracker.sh`    | PostToolUse             | Track files read                                   |


### Agents


| Agent           | Purpose                               |
| --------------- | ------------------------------------- |
| `code-reviewer` | Multi-layer code review               |
| `implementer`   | TDD implementation                    |
| `planner`       | Codebase exploration + task breakdown |
| `writer`        | Lightweight doc writer (haiku)        |
| `writer-deep`   | Deep reasoning doc writer (sonnet)    |


### Project Structure

```
coding-friend/
‚îú‚îÄ‚îÄ marketplace.json         # Marketplace manifest
‚îú‚îÄ‚îÄ CLAUDE.md                # Claude Code rules
‚îú‚îÄ‚îÄ .coding-friend/          # User config (optional)
‚îÇ   ‚îú‚îÄ‚îÄ config.json          # Settings
‚îÇ   ‚îî‚îÄ‚îÄ ignore               # Agent ignore patterns
‚îú‚îÄ‚îÄ plugin/                  # ‚Üê Only this gets cached by Claude Code
‚îÇ   ‚îú‚îÄ‚îÄ .claude-plugin/      # Plugin manifest
‚îÇ   ‚îú‚îÄ‚îÄ hooks/               # Lifecycle hooks
‚îÇ   ‚îú‚îÄ‚îÄ skills/              # 15 skills
‚îÇ   ‚îî‚îÄ‚îÄ agents/              # Subagent definitions
‚îú‚îÄ‚îÄ cli/                     # Standalone CLI (npm: coding-friend-cli)
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ learn-host/          # Next.js static site for learning docs
‚îÇ   ‚îî‚îÄ‚îÄ learn-mcp/           # MCP server for LLM integration
‚îî‚îÄ‚îÄ docs/                    # Generated docs
    ‚îú‚îÄ‚îÄ plans/               # Implementation plans
    ‚îú‚îÄ‚îÄ memory/              # Project knowledge
    ‚îú‚îÄ‚îÄ learn/               # Human learning notes
    ‚îî‚îÄ‚îÄ research/            # In-depth research results
```

## License

MIT
